(()=>{var Q=(...a)=>nt(ot(...a));var v=new AudioContext,nt=(...a)=>{let e=v.createBuffer(a.length,a[0].length,44100),m=v.createBufferSource();return a.map((g,S)=>e.getChannelData(S).set(g)),m.buffer=e,m.connect(v.destination),m.start(),m},ot=(a=1,e=.05,m=220,g=0,S=0,k=.1,G=0,D=1,M=0,H=0,N=0,z=0,p=0,L=0,R=0,n=0,x=0,w=1,_=0,F=0)=>{let s=Math.PI*2,O=t=>t>0?1:-1,P=M*=500*s/44100/44100,A=m*=(1+e*2*Math.random()-e)*s/44100,X=[],b=0,V=0,r=0,W=1,B=0,j=0,I=0,K,E;for(g=g*44100+9,_*=44100,S*=44100,k*=44100,x*=44100,H*=500*s/44100**3,R*=s/44100,N*=s/44100,z*=44100,p=p*44100|0,E=g+_+S+k+x|0;r<E;X[r++]=I)++j%(n*100|0)||(I=G?G>1?G>2?G>3?Math.sin((b%s)**3):Math.max(Math.min(Math.tan(b),1),-1):1-(2*b/s%2+2)%2:1-4*Math.abs(Math.round(b/s)-b/s):Math.sin(b),I=(p?1-F+F*Math.sin(s*r/p):1)*O(I)*Math.abs(I)**D*a*.3*(r<g?r/g:r<g+_?1-(r-g)/_*(1-w):r<g+_+S?w:r<E-x?(E-r-x)/k*w:0),I=x?I/2+(x>r?0:(r<E-x?1:(E-r)/x)*X[r-x|0]/2):I),K=(m+=M+=H)*Math.cos(R*V++),b+=K-K*L*(1-(Math.sin(r)+1)*1e9%2),W&&++W>z&&(m+=N,A+=N,W=0),p&&!(++B%p)&&(m=A,M=P,W=W||1);return X};var d=["#0a080d","#f4f4f4","#697594","#f7aaa8","#d4689a","#782c96","#e83562","#f2825c","#ffc76e","#88c44d","#3f9e59","#373461","#4854a8","#7199d9","#9e5252","#4d2536"];var U=[[1.5,,332,.01,.03,.2,,1.24,-3.6,,,,,.4,309,.3,,.77,.09],[1.5,,603,,.02,0,,.04,,-.4,473,,,.1,,,.18,.2,.1],[1.5,,152,.01,.07,.06,1,1.21,-16,,,,,,,,,.62,.03],[,,468,.02,.22,.45,1,.84,,5.6,-37,.05,.09,,,,,.8,.27,.05],[,,1959,.01,.04,.12,,.2,,.1,252,.04,,.1,,,,.5,.01,.09],[2.5,,450,.05,.15,.38,1,1.72,.2,-.2,128,.13,.18,,,,.08,.79,.13,.31],[1.5,0,261.6256,.07,.1,.26,,1.58,,,,,,.3,,.1,,.43,.17],[2.63,,1727,,.03,.23,,2.65,,-89,5,.06,,,166,,.12,.72],[,,391,.03,.26,.45,1,.07,,,-11,.07,.1,,,,,.56,.14,.2],[1.34,,1117,.07,.07,0,2,.05,,,274,.08,.11,,10,,.09,.82,.11],[,,1705,.24,.15,.12,2,2.97,-5.7,,300,.04,.08],[1.35,,470,.18,.07,0,,2.23,,,-948,,.12,.1,-37,,.01,,,.21],[,,248,,.06,.07,4,1.26,,.3,,,.01,,,.1,,.7,.06,.38],[2.5,,328,.03,.26,.4,4,1.09,.5,.1,,,,.5,,.3,.33,.43,.05,.45],[1.5,,0,.02,,.04,,.37,9.9,,,,,.1,,,.24,,.15],[2,,657,.22,.33,0,3,.28,,-.7,,,.36,,,,.13,.8,.02,.73]];var u=globalThis;u.floppy=Z;function Z(a={}){let e={WIDTH:a.width??null,HEIGHT:a.height??null,CANVAS:document.createElement("canvas"),PARENT:a.parent??document.body,TAPPED:!1,TAPX:0,TAPY:0,TICKS:0,ELAPSED:0,FPS:0,math:u.Math,loop:{init:[],update:[],draw:[]}},m=a.fps??60,g=a.background??null,S=a.global??!0,k=a.antialias??!0,G=a.pixelart??!1,D=a.fullscreen??!0,M=a.autoscale??!0,H=a.loop??{},N=a.plugins??[],z=1,p={top:0,left:0},L=null,R=null,n=null,x=null,w=0,_=0,F=1/m,s=1e3/m,O=0,P=0,A={count:0,time:0},X=Math.PI/180,b=180/Math.PI,V=Math.PI*2,r={set(t,o){e[t]=o,S&&(u[t]=o)}};function W(){_RATIO=e.WIDTH/e.HEIGHT,L=e.WIDTH,R=e.HEIGHT;function t(o){E(!0,o.pageX||0,o.pageY||0)}e.CANVAS.addEventListener("click",function(o){o.preventDefault(),t(o)},!1),e.CANVAS.addEventListener("touchstart",function(o){o.preventDefault(),t(o.touches[0])},!1),window.addEventListener("focus",()=>{P===0&&(w=performance.now(),P=requestAnimationFrame(B))}),window.addEventListener("blur",()=>{P&&(cancelAnimationFrame(P),P=0)}),I(),(M||D)&&u.addEventListener("resize",I),(H.init||u.init)&&e.loop.init.push(H.init||u.init),(H.update||u.update)&&e.loop.update.push(H.update||u.update),(H.draw||u.draw)&&e.loop.draw.push(H.draw||u.draw),N.sort((o,i)=>(o.priority??10)-(i.priority??10));for(let o of N){let i=o(e,r);for(let l in i)r.set(l,i[l])}for(let o of e.loop.init)o();g!=null&&(e.CANVAS.style.backgroundColor=d[g%16]),w=performance.now(),P=requestAnimationFrame(B)}function B(){let t=0;for(x=performance.now(),_=x-w,w=x,O+=_,_>1e3&&(O=s);O>=s;){for(let o of e.loop.update)o(F);E(!1,0,0),O-=s,t++}if(t>0){r.set("TICKS",e.TICKS+t),r.set("ELAPSED",e.ELAPSED+t*F);for(let o of e.loop.draw)o();A.count++,A.time+=t*F,A.time>=1&&(r.set("FPS",A.count),A.time-=1,A.count=0)}P=requestAnimationFrame(B)}function j(t){e.WIDTH>0&&D&&(D=!1,e.HEIGHT=e.HEIGHT>0?e.HEIGHT:e.WIDTH),t.width=e.WIDTH,t.height=e.HEIGHT,e.PARENT.appendChild(t),t.ctx=t.getContext("2d"),n=t.ctx,t.style.display="block",D?(t.style.position="absolute",t.style.top=t.style.bottom=t.style.left=t.style.right=0):M&&(t.style.margin="auto"),G&&(k=!1),k||(n.imageSmoothingEnabled=!1,t.style.imageRendering="pixelated"),p.top=t.offsetTop,p.left=t.offsetLeft}function I(){let t=e.CANVAS;!M&&!D||(L=u.innerWidth,R=u.innerHeight,D?(t.width=L,t.height=R,r.set("WIDTH",L),r.set("HEIGHT",R)):M&&(z=Math.min(L/e.WIDTH,R/e.HEIGHT),z=G?Math.floor(z):z,t.style.width=e.WIDTH*z+"px",t.style.height=e.HEIGHT*z+"px"),p.top=t.offsetTop,p.left=t.offsetLeft)}function K(){for(let t in e)t in u||(u[t]=e[t])}function E(t,o,i){r.set("TAPX",(o-p.left)/z),r.set("TAPY",(i-p.top)/z),r.set("TAPPED",t)}return e.math.rand=Math.random,e.math.randi=function(t=1,o=100){return Math.floor(Math.random()*(o-t+1)+t)},e.math.lerp=function(t,o,i){return t+(o-t)*i},e.math.deg2rad=function(t){return t*X},e.math.rad2deg=function(t){return t*b},e.math.clamp=function(t,o,i){return Math.min(Math.max(t,o),i)},e.clear=function(t=null){t==null?n.clearRect(0,0,e.WIDTH,e.HEIGHT):(n.fillStyle=d[~~t%16],n.beginPath(),n.fillRect(0,0,e.WIDTH,e.HEIGHT))},e.rect=function(t,o,i,l,f=0,h=1){n.strokeStyle=d[~~f%16],n.lineWidth=~~h,n.beginPath(),n.strokeRect(~~t,~~o,~~i,~~l)},e.rectfill=function(t,o,i,l,f=0){n.fillStyle=d[~~f%16],n.beginPath(),n.fillRect(~~t,~~o,~~i,~~l)},e.circle=function(t,o,i,l=0,f=1){n.strokeStyle=d[~~l%16],n.lineWidth=~~f,n.beginPath(),n.arc(~~t,~~o,~~i,0,V),n.closePath(),n.stroke()},e.circlefill=function(t,o,i,l=0){n.fillStyle=d[~~l%16],n.beginPath(),n.arc(~~t,~~o,~~i,0,V),n.closePath(),n.fill()},e.oval=function(t,o,i,l,f=0,h=1){n.strokeStyle=d[~~f%16],n.lineWidth=~~h,n.beginPath(),n.ellipse(~~t+~~i,~~o+~~l,~~i,~~l,0,0,V),n.closePath(),n.stroke()},e.ovalfill=function(t,o,i,l,f=0){n.fillStyle=d[~~f%16],n.beginPath(),n.ellipse(~~t+~~i,~~o+~~l,~~i,~~l,0,0,V),n.closePath(),n.fill()},e.triangle=function(t,o,i,l,f,h,T=0,Y=1){e.poly([t,o,i,l,f,h],T,Y)},e.trianglefill=function(t,o,i,l,f,h,T=0){e.polyfill([t,o,i,l,f,h],T)},e.poly=function(t,o=0,i=1){n.strokeStyle=d[~~o%16],n.lineWidth=~~i,n.beginPath();let l=t.length;for(let f=0;f<l;f+=2)f===0?n.moveTo(t[f],t[f+1]):n.lineTo(t[f],t[f+1]);n.lineTo(t[0],t[1]),n.stroke()},e.polyfill=function(t,o=0){n.fillStyle=d[~~o%16],n.beginPath();let i=t.length;for(let l=0;l<i;l+=2)l===0?n.moveTo(t[l],t[l+1]):n.lineTo(t[l],t[l+1]);n.lineTo(t[0],t[1]),n.fill()},e.line=function(t,o,i,l,f=0,h=1){n.strokeStyle=d[~~f%16],n.beginPath(),n.lineWidth=~~h,n.moveTo(~~t,~~o),n.lineTo(~~i,~~l),n.stroke()},e.text=function(t,o,i,l=0,f=null,h="monospace"){f=f||Math.max(16,e.HEIGHT/16),n.textBaseline="top",n.font=~~f+"px "+h,n.fillStyle=d[~~l%16],n.fillText(i,~~t,~~o)},e.image=function(t,o,i){n.drawImage(i,~~t,~~o)},e.paint=function(t,o,i){let l=new OffscreenCanvas(t,o),f=n;if(l.width=t,l.height=o,n=l.getContext("2d"),typeof i=="function")i(l,n);else if(Array.isArray(i)){let h=n.createImageData(t,o),T=h.data,Y=y=0;for(let $ of i){for(let q of $.split("")){let C=y*(t*4)+Y*4;if(q===" "||q===".")T[C]=0,T[C+1]=0,T[C+2]=0,T[C+3]=0;else{c=d[~~parseInt(q,16)];let J=parseInt(c.slice(1,3),16),tt=parseInt(c.slice(3,5),16),et=parseInt(c.slice(5,7),16);T[C]=J,T[C+1]=tt,T[C+2]=et,T[C+3]=255}Y++}y++,Y=0}n.putImageData(h,0,0)}return n=f,l},e.transform=function(t,o,i=1,l=0){n.setTransform(i,0,0,i,t,o),n.rotate(e.math.deg2rad(l))},e.push=function(){n.save()},e.pop=function(){n.restore()},e.sfx=function(t=0,o=1,i=0,l=0){let f=Array.isArray(t)?t:U[~~t%16];return(o!==1||i!==0||l!==0)&&(f=[...f],f[0]=(Number(o)||1)*(f[0]||1),f[1]=Number(l)>0?l:0,f[10]=~~f[10]+~~i),Q(...f)},S&&K(),j(e.CANVAS),u.document.readyState==="loading"?u.addEventListener("DOMContentLoaded",W):W(),e}})();
